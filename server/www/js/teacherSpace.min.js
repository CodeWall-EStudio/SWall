!function(b){var a=function(f,a){this.element=b(f);this.format=d.parseFormat(a.format||this.element.data("date-format")||"mm/dd/yyyy");this.picker=b(d.template).appendTo("body").on({click:b.proxy(this.click,this)});this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):!1;if(this.isInput)this.element.on({focus:b.proxy(this.show,this),keyup:b.proxy(this.update,this)});else if(this.component)this.component.on("click",b.proxy(this.show,this));else this.element.on("click",
b.proxy(this.show,this));this.minViewMode=a.minViewMode||this.element.data("date-minviewmode")||0;if("string"===typeof this.minViewMode)switch(this.minViewMode){case "months":this.minViewMode=1;break;case "years":this.minViewMode=2;break;default:this.minViewMode=0}this.viewMode=a.viewMode||this.element.data("date-viewmode")||0;if("string"===typeof this.viewMode)switch(this.viewMode){case "months":this.viewMode=1;break;case "years":this.viewMode=2;break;default:this.viewMode=0}this.startViewMode=this.viewMode;
this.weekStart=a.weekStart||this.element.data("date-weekstart")||0;this.weekEnd=0===this.weekStart?6:this.weekStart-1;this.onRender=a.onRender;this.fillDow();this.fillMonths();this.update();this.showMode()};a.prototype={constructor:a,show:function(f){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();b(window).on("resize",b.proxy(this.place,this));f&&(f.stopPropagation(),f.preventDefault());var a=this;b(document).on("mousedown",function(f){0==
b(f.target).closest(".datepicker").length&&a.hide()});this.element.trigger({type:"show",date:this.date})},hide:function(){this.picker.hide();b(window).off("resize",this.place);this.viewMode=this.startViewMode;this.showMode();this.isInput||b(document).off("mousedown",this.hide);this.element.trigger({type:"hide",date:this.date})},set:function(){var f=d.formatDate(this.date,this.format);this.isInput?this.element.prop("value",f):(this.component&&this.element.find("input").prop("value",f),this.element.data("date",
f))},setValue:function(f){this.date="string"===typeof f?d.parseDate(f,this.format):new Date(f);this.set();this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill()},place:function(){var f=this.component?this.component.offset():this.element.offset();this.picker.css({top:f.top+this.height,left:f.left})},update:function(f){this.date=d.parseDate("string"===typeof f?f:this.isInput?this.element.prop("value"):this.element.data("date"),this.format);this.viewDate=new Date(this.date.getFullYear(),
this.date.getMonth(),1,0,0,0,0);this.fill()},fillDow:function(){for(var f=this.weekStart,b="<tr>";f<this.weekStart+7;)b+='<th class="dow">'+d.dates.daysMin[f++%7]+"</th>";b+="</tr>";this.picker.find(".datepicker-days thead").append(b)},fillMonths:function(){for(var b="",a=0;12>a;)b+='<span class="month">'+d.dates.monthsShort[a++]+"</span>";this.picker.find(".datepicker-months td").append(b)},fill:function(){var b=new Date(this.viewDate),a=b.getFullYear(),l=b.getMonth(),k=this.date.valueOf();this.picker.find(".datepicker-days th:eq(1)").text(d.dates.months[l]+
" "+a);var g=new Date(a,l-1,28,0,0,0,0),b=d.getDaysInMonth(g.getFullYear(),g.getMonth());g.setDate(b);g.setDate(b-(g.getDay()-this.weekStart+7)%7);var n=new Date(g);n.setDate(n.getDate()+42);for(var n=n.valueOf(),b=[],e,c,m;g.valueOf()<n;){g.getDay()===this.weekStart&&b.push("<tr>");e=this.onRender(g);c=g.getFullYear();m=g.getMonth();if(m<l&&c===a||c<a)e+=" old";else if(m>l&&c===a||c>a)e+=" new";g.valueOf()===k&&(e+=" active");b.push('<td class="day '+e+'">'+g.getDate()+"</td>");g.getDay()===this.weekEnd&&
b.push("</tr>");g.setDate(g.getDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(b.join(""));l=this.date.getFullYear();b=this.picker.find(".datepicker-months").find("th:eq(1)").text(a).end().find("span").removeClass("active");l===a&&b.eq(this.date.getMonth()).addClass("active");b="";a=10*parseInt(a/10,10);k=this.picker.find(".datepicker-years").find("th:eq(1)").text(a+"-"+(a+9)).end().find("td");a-=1;for(g=-1;11>g;g++)b+='<span class="year'+(-1===g||10===g?" old":"")+(l===a?" active":
"")+'">'+a+"</span>",a+=1;k.html(b)},click:function(a){a.stopPropagation();a.preventDefault();var h=b(a.target).closest("span, td, th");if(1===h.length)switch(h[0].nodeName.toLowerCase()){case "th":switch(h[0].className){case "switch":this.showMode(1);break;case "prev":case "next":this.viewDate["set"+d.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate["get"+d.modes[this.viewMode].navFnc].call(this.viewDate)+d.modes[this.viewMode].navStep*("prev"===h[0].className?-1:1)),this.fill(),this.set()}break;
case "span":h.is(".month")?(a=h.parent().find("span").index(h),this.viewDate.setMonth(a)):(h=parseInt(h.text(),10)||0,this.viewDate.setFullYear(h));0!==this.viewMode&&(this.date=new Date(this.viewDate),this.element.trigger({type:"changeDate",date:this.date,viewMode:d.modes[this.viewMode].clsName}));this.showMode(-1);this.fill();this.set();break;case "td":if(h.is(".day")&&!h.is(".disabled")){var l=parseInt(h.text(),10)||1;a=this.viewDate.getMonth();h.is(".old")?a-=1:h.is(".new")&&(a+=1);h=this.viewDate.getFullYear();
this.date=new Date(h,a,l,0,0,0,0);this.viewDate=new Date(h,a,Math.min(28,l),0,0,0,0);this.fill();this.set();this.element.trigger({type:"changeDate",date:this.date,viewMode:d.modes[this.viewMode].clsName})}}},mousedown:function(a){a.stopPropagation();a.preventDefault()},showMode:function(a){a&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+a)));this.picker.find(">div").hide().filter(".datepicker-"+d.modes[this.viewMode].clsName).show()}};b.fn.datepicker=function(f,h){return this.each(function(){var d=
b(this),k=d.data("datepicker"),g="object"===typeof f&&f;k||d.data("datepicker",k=new a(this,b.extend({},b.fn.datepicker.defaults,g)));if("string"===typeof f)k[f](h)})};b.fn.datepicker.defaults={onRender:function(a){return""}};b.fn.datepicker.Constructor=a;var d={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],dates:{days:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),daysShort:"Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),
daysMin:"Su Mo Tu We Th Fr Sa Su".split(" "),months:"January February March April May June July August September October November December".split(" "),monthsShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")},isLeapYear:function(a){return 0===a%4&&0!==a%100||0===a%400},getDaysInMonth:function(a,b){return[31,d.isLeapYear(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]},parseFormat:function(a){var b=a.match(/[.\/\-\s].*?/);a=a.split(/\W+/);if(!b||!a||0===a.length)throw Error("Invalid date format.");
return{separator:b,parts:a}},parseDate:function(a,b){var d=a.split(b.separator);a=new Date;var k;a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);if(d.length===b.parts.length){for(var g=a.getFullYear(),n=a.getDate(),e=a.getMonth(),c=0,m=b.parts.length;c<m;c++)switch(k=parseInt(d[c],10)||1,b.parts[c]){case "dd":case "d":n=k;a.setDate(k);break;case "mm":case "m":e=k-1;a.setMonth(k-1);break;case "yy":g=2E3+k;a.setFullYear(2E3+k);break;case "yyyy":g=k,a.setFullYear(k)}a=new Date(g,e,
n,0,0,0)}return a},formatDate:function(a,b){var d={d:a.getDate(),m:a.getMonth()+1,yy:a.getFullYear().toString().substring(2),yyyy:a.getFullYear()};d.dd=(10>d.d?"0":"")+d.d;d.mm=(10>d.m?"0":"")+d.m;a=[];for(var k=0,g=b.parts.length;k<g;k++)a.push(d[b.parts[k]]);return a.join(b.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};d.template='<div class="datepicker dropdown-menu"><div class="datepicker-days"><table class=" table-condensed">'+
d.headTemplate+'<tbody></tbody></table></div><div class="datepicker-months"><table class="table-condensed">'+d.headTemplate+d.contTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+d.headTemplate+d.contTemplate+"</table></div></div>"}(window.jQuery);(function(b){function a(a,e){this.itemsArray=[];this.$element=b(a);this.$element.hide();this.multiple=(this.isSelect="SELECT"===a.tagName)&&a.hasAttribute("multiple");this.objectItems=e&&e.itemValue;this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=b('<div class="bootstrap-tagsinput"></div>');this.$input=b('<input size="'+this.inputSize+'" type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);
this.$element.after(this.$container);this.build(e)}function d(a,b){if("function"!==typeof a[b]){var c=a[b];a[b]=function(a){return a[c]}}}function f(a,b){if("function"!==typeof a[b]){var c=a[b];a[b]=function(){return c}}}function h(a){return a?g.text(a).html():""}function l(a){var b=0;if(document.selection)a.focus(),b=document.selection.createRange(),b.moveStart("character",-a.value.length),b=b.text.length;else if(a.selectionStart||"0"==a.selectionStart)b=a.selectionStart;return b}var k={tagClass:function(a){return"label label-info"},
itemValue:function(a){return a?a.toString():a},itemText:function(a){return this.itemValue(a)},freeInput:!0,maxTags:void 0,confirmKeys:[13],onTagExists:function(a,b){b.hide().fadeIn()}};a.prototype={constructor:a,add:function(a,e){var c=this;if(!(c.options.maxTags&&c.itemsArray.length>=c.options.maxTags||!1!==a&&!a)){if("object"===typeof a&&!c.objectItems)throw"Can't add objects when itemValue option is not set";if(!a.toString().match(/^\s*$/)){c.isSelect&&!c.multiple&&0<c.itemsArray.length&&c.remove(c.itemsArray[0]);
if("string"===typeof a&&"INPUT"===this.$element[0].tagName){var m=a.split(",");if(1<m.length){for(var d=0;d<m.length;d++)this.add(m[d],!0);e||c.pushVal();return}}var f=c.options.itemValue(a),m=c.options.itemText(a),d=c.options.tagClass(a),g=b.grep(c.itemsArray,function(a){return c.options.itemValue(a)===f})[0];g?c.options.onTagExists&&(m=b(".tag",c.$container).filter(function(){return b(this).data("item")===g}),c.options.onTagExists(a,m)):(c.itemsArray.push(a),d=b('<span class="tag '+h(d)+'">'+h(m)+
'<span data-role="remove"></span></span>'),d.data("item",a),c.findInputWrapper().before(d),d.after(" "),c.isSelect&&!b('option[value="'+escape(f)+'"]',c.$element)[0]&&(m=b("<option selected>"+h(m)+"</option>"),m.data("item",a),m.attr("value",f),c.$element.append(m)),e||c.pushVal(),c.options.maxTags===c.itemsArray.length&&c.$container.addClass("bootstrap-tagsinput-max"),c.$element.trigger(b.Event("itemAdded",{item:a})))}}},remove:function(a,e){var c=this;c.objectItems&&(a="object"===typeof a?b.grep(c.itemsArray,
function(b){return c.options.itemValue(b)==c.options.itemValue(a)})[0]:b.grep(c.itemsArray,function(b){return c.options.itemValue(b)==a})[0]);a&&(b(".tag",c.$container).filter(function(){return b(this).data("item")===a}).remove(),b("option",c.$element).filter(function(){return b(this).data("item")===a}).remove(),c.itemsArray.splice(b.inArray(a,c.itemsArray),1));e||c.pushVal();c.options.maxTags>c.itemsArray.length&&c.$container.removeClass("bootstrap-tagsinput-max");c.$element.trigger(b.Event("itemRemoved",
{item:a}))},removeAll:function(){b(".tag",this.$container).remove();for(b("option",this.$element).remove();0<this.itemsArray.length;)this.itemsArray.pop();this.pushVal();this.options.maxTags&&!this.isEnabled()&&this.enable()},refresh:function(){var a=this;b(".tag",a.$container).each(function(){var e=b(this),c=e.data("item"),d=a.options.itemValue(c),f=a.options.itemText(c),g=a.options.tagClass(c);e.attr("class",null);e.addClass("tag "+h(g));e.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=
h(f);a.isSelect&&b("option",a.$element).filter(function(){return b(this).data("item")===c}).attr("value",d)})},items:function(){return this.itemsArray},pushVal:function(){var a=this,e=b.map(a.items(),function(b){return a.options.itemValue(b).toString()});a.$element.val(e,!0).trigger("change")},build:function(a){var e=this;e.options=b.extend({},k,a);var c=e.options.typeahead||{};e.objectItems&&(e.options.freeInput=!1);d(e.options,"itemValue");d(e.options,"itemText");d(e.options,"tagClass");e.options.source&&
(c.source=e.options.source);c.source&&b.fn.typeahead&&(f(c,"source"),e.$input.typeahead({source:function(a,d){function f(a){for(var b=[],c=0;c<a.length;c++){var m=e.options.itemText(a[c]);h[m]=a[c];b.push(m)}d(b)}var h=this.map={},g=c.source(a);b.isFunction(g.success)?g.success(f):b.when(g).then(f)},updater:function(a){e.add(this.map[a])},matcher:function(a){return-1!==a.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(a){return a.sort()},highlighter:function(a){return a.replace(RegExp("("+
this.query+")","gi"),"<strong>$1</strong>")}}));e.$container.on("click",b.proxy(function(a){e.$input.focus()},e));e.$container.on("keydown","input",b.proxy(function(a){var c=b(a.target),d=e.findInputWrapper();switch(a.which){case 8:0===l(c[0])&&(d=d.prev())&&e.remove(d.data("item"));break;case 46:0===l(c[0])&&(d=d.next())&&e.remove(d.data("item"));break;case 37:a=d.prev();0===c.val().length&&a[0]&&(a.before(d),c.focus());break;case 39:a=d.next();0===c.val().length&&a[0]&&(a.after(d),c.focus());break;
default:e.options.freeInput&&0<=b.inArray(a.which,e.options.confirmKeys)&&(e.add(c.val()),c.val(""),a.preventDefault())}c.attr("size",Math.max(this.inputSize,c.val().length))},e));e.$container.on("click","[data-role=remove]",b.proxy(function(a){e.remove(b(a.target).closest(".tag").data("item"))},e));e.options.itemValue===k.itemValue&&("INPUT"===e.$element[0].tagName?e.add(e.$element.val()):b("option",e.$element).each(function(){e.add(b(this).attr("value"),!0)}))},destroy:function(){this.$container.off("keypress",
"input");this.$container.off("click","[role=remove]");this.$container.remove();this.$element.removeData("tagsinput");this.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var a=this.$input[0],e=this.$container[0];a&&a.parentNode!==e;)a=a.parentNode;return b(a)}};b.fn.tagsinput=function(d,e){var c=[];this.each(function(){var f=b(this).data("tagsinput");f?(f=f[d](e),void 0!==f&&c.push(f)):(f=new a(this,d),b(this).data("tagsinput",
f),c.push(f),"SELECT"===this.tagName&&b("option",b(this)).attr("selected","selected"),b(this).val(b(this).val()))});return"string"==typeof d?1<c.length?c:c[0]:c};b.fn.tagsinput.Constructor=a;var g=b("<div />");b(function(){b("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);angular.module("ts.utils.constants",[]).constant("BACKEND_SERVER","localhost"==location.hostname?"http://localhost:8080":"").constant("EVENT_LOGIN","event.login").constant("EVENT_MODE_CHANGE","event.mode.change").constant("CMD_SHOW_ACTIVITY_PANEL","cmd.activity.panel.show");angular.module("ts.services.user",["ts.utils.constants"]).service("UserService",["$rootScope","$location","$http","EVENT_LOGIN",function(b,a,d,f){function h(){return a.search().uid}return{uid:h,hasLoggedIn:function(){return void 0!==h()},login:function(h,k,g){d.post("");a.search("uid",h);g(0);b.$emit(f,0)}}}]);angular.module("ts.services.activity",["ts.utils.constants","ts.services.user"]).service("ActivityService",["$rootScope","$http","UserService","BACKEND_SERVER",function(b,a,d,f){function h(a){a?(b.selectedActivity=a,b.selectedActivityID=a._id):(b.selectedActivity=null,b.selectedActivityID="");console.log("[ActivityService] selected activity",b.selectedActivity)}function l(e,c,h,g){c=n(c);a.put(f+"/activities/"+e+"?uid="+d.uid(),c,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,
c){if(a&&!a.c&&a.r)a:{var e=a.r;b.activityMap[e._id]=e;for(var d=0;d<b.activityList.length;++d)for(var f=b.activityList[d].activities,g=0;g<f.length;++g)if(f[g]._id==e._id){b.selectedActivity==f[g]&&(b.selectedActivity=e,b.selectedActivityID=e._id);f[g]=e;break a}}h&&h(a,c)}).error(g)}function k(a,c){b.activityList.splice(a,0,{date:g(c),activities:[c]})}function g(a){a=new Date(a.info.date);a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);return a.getTime().toString()}function n(a){return _.map(a,
function(a,b){return encodeURIComponent(b)+"="+encodeURIComponent(a)}).join("&")}b.activityList=[];b.activityMap={};b.selectedActivity=null;b.selectedActivityID="";return{selectActivity:h,selectActivityByID:function(a){h(b.activityMap[a])},fetchActivities:function(e,c,h){e=e||{};"manager"==b.mode()&&(e.creator=d.uid());console.log("[ActivityService] fetching activities with",e);a.get(f+"/activities?uid="+d.uid(),{responseType:"json",params:e}).success(function(a,d){if(200===d&&!a.c){var e=a.r.activities,
f=_.groupBy(e,function(a){return g(a)});b.activityList=_.map(f,function(a,b){return{date:b,activities:a}});b.activityMap=_.reduce(e,function(a,b){a[b._id]=b;return a},{})}c&&c(a,d)}).error(h)},createActivity:function(e,c,h){e=n(e);a.post(f+"/activities?uid="+d.uid(),e,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,d){if(a&&!a.c&&a.r)a:{var e=a.r[0];b.activityMap[e._id]=e;for(var f=g(e),h=0;h<b.activityList.length;++h){var l=b.activityList[h];
if(l.date==f){l.activities.unshift(e);break a}else if(l.date>f){k(h,e);break a}}k(h,e)}c&&c(a,d)}).error(h)},updateActivity:l,closeActivity:function(a,b,d){l(a,{status:"closed"},b,d)},fetchActivityConfig:function(b,c){a.get(f+"/activities/config",null,{responseType:"json"}).success(function(a,c){console.log("[ActivityService] activity config =",a);b&&b(a,c)}).error(function(a,b){console.error("[ActivityService] FAIL TO FETCH ACTIVITY CONFIGURATIONS");c&&c(a,b)})}}}]);angular.module("ts.controllers.activityDetail",["ts.utils.constants","ts.services.activity","ts.controllers.main"]).controller("ActivityDetailController",["$rootScope","$scope","ActivityService","EVENT_MODE_CHANGE","CMD_SHOW_ACTIVITY_PANEL",function(b,a,d,f,h){a.userCount=function(){if(b.selectedActivity){if(b.selectedActivity.active)return b.selectedActivity.users.participators.length;var a=_.countBy(b.selectedActivity.resources,function(a){return a.user});return _.keys(a).length}return 0};a.editActivity=
function(){b.$emit(h,{panelTitle:"\u7f16\u8f91\u6d3b\u52a8",confirmBtnTitle:"\u4fdd\u5b58",activity:$.extend(!0,{},b.selectedActivity)})};a.closeActivity=function(){confirm("\u786e\u5b9a\u8981\u5173\u95ed\u6d3b\u52a8\uff1f")&&d.closeActivity(b.selectedActivity._id)};a.deleteActivity=function(){};a.handlePlayBtnClick=function(){window.open("activity_play.html#?aid="+b.selectedActivity._id,"_blank")};b.$on(f,function(a,b){d.selectActivity()})}]);angular.module("ts.controllers.activityList",["ts.services.activity"]).controller("ActivityListController",["$rootScope","$scope","ActivityService",function(b,a,d){a.selectActivity=function(a){d.selectActivityByID(a)}}]);angular.module("ts.controllers.activityPanel",["ts.utils.constants","ts.services.activity"]).controller("ActivityPanelController",["$rootScope","$scope","$http","ActivityService","CMD_SHOW_ACTIVITY_PANEL",function(b,a,d,f,h){function l(a,b){console.log(a,b);m.removeAttribute("disabled");n.modal("hide")}function k(b,c){b=b||{c:-1,msg:"UNKNOWN"};a.errMsg=c+" - ["+b.c+"] "+b.m;m.removeAttribute("disabled")}function g(){m.setAttribute("disabled","disabled")}var n=$("#createActivityModal"),e=$("input[activity-date-picker]"),
c=$('input[data-role="tagsinput"]'),m=document.getElementById("activityFormAllFields"),p=document.getElementById("activityFormFieldsForOpenActivities"),q={info:{type:1},users:{invitedUsers:[]}};b.$on(h,function(b,d){d=d||{};a.panelTitle=d.panelTitle||"\u521b\u5efa\u6d3b\u52a8";a.confirmBtnTitle=d.confirmBtnTitle||"\u521b\u5efa\u6d3b\u52a8";a.cancelBtnTitle=d.cancelBtnTitle||"\u53d6\u6d88";a.activity=d.activity||$.extend(!0,{},q);a.invitedUsers=a.activity.users.invitedUsers.join(",");var f=a.activity.info.date;
f&&e.datepicker("setValue",new Date(f));_.each(a.activity.users.invitedUsers,function(a){c.tagsinput("add",a)});a.showActivityPanel()});n.on("hidden.bs.modal",function(){a.activity=$.extend(!0,{},q);a.grade=a.cls=a.subject=0;a.errMsg="";c.tagsinput("removeAll")});a.$watch("grade",function(b){a.cls=0});a.showActivityPanel=function(){$("#createActivityModal").modal("show");!a.activity._id||a.activity.active?p.removeAttribute("disabled"):p.setAttribute("disabled","disabled")};a.createActivity=function(){a.errMsg=
"";g();var b=a.config?a.config.activityConfig:{},b={uids:a.invitedUsers||"",title:a.activity.info.title||"",type:a.activity.info.type|1,desc:a.activity.info.desc||"",date:a.activity.info.date?a.activity.info.date.getTime():0,teacher:a.activity.info.teacher||"",grade:b.classes[a.grade].grade,"class":b.classes[a.grade].cls[a.cls],subject:b.subjects[a.subject],domain:a.activity.info.domain||""};f.createActivity(b,l,k)};a.updateActivity=function(){a.errMsg="";g();var b=a.config?a.config.activityConfig:
{},c={uids:a.invitedUsers||""};a.activity.active&&(c.title=a.activity.info.title||"",c.type=a.activity.info.type||"",c.desc=a.activity.info.desc||"",c.date=a.activity.info.date||0,c.teacher=a.activity.info.teacher||"",c.grade=b.classes[a.grade].grade||"",c["class"]=b.classes[a.grade].cls[a.cls]||"",c.subject=b.subjects[a.subject]||"",c.domain=a.activity.info.domain||"");f.updateActivity(a.activity._id,c,l,k)};a.handleConfirmBtnClick=function(){a.activity._id?a.updateActivity():a.createActivity()};
(function(){f.fetchActivityConfig(function(b,c){a.config=b;a.grade=0;a.cls=0;a.subject=0})})()}]);angular.module("ts.controllers.loginForm",["ts.services.user"]).controller("LoginFormController",["$rootScope","$scope","UserService",function(b,a,d){a.uid="";a.pwd="";a.errMsg="";a.login=function(){a.uid?a.pwd?d.login(a.uid,a.pwd,function(b){b||$("#loginModal").modal("hide");a.uid=a.pwd=a.errMsg=""}):a.errMsg="\u8bf7\u8f93\u5165\u5bc6\u7801":a.errMsg="\u8bf7\u8f93\u5165\u5e10\u53f7\u540d"}}]);angular.module("ts.controllers.main",["ts.utils.constants","ts.services.user","ts.services.activity"]).controller("MainController",["$rootScope","$scope","$http","$location","UserService","ActivityService","EVENT_LOGIN","EVENT_MODE_CHANGE",function(b,a,d,f,h,l,k,g){b.$on(k,function(a,d){b.fetchActivities()});b.fetchActivities=function(a){l.selectActivity();l.fetchActivities(a)};b.showLoginModal=function(){h.hasLoggedIn()||$("#loginModal").modal("show")};b.mode=function(){return f.search().mode};b.gotoMode=
function(a){a!==b.mode()&&(f.search("mode",a),b.$emit(g,a))};h.hasLoggedIn()?b.fetchActivities():b.showLoginModal()}]);angular.module("ts.controllers.navigator",["ts.services.user"]).controller("NavigatorController",["$rootScope","$scope","UserService","EVENT_LOGIN",function(b,a,d,f){a.username=d.uid();b.$on(f,function(b,f){a.username=d.uid()})}]);angular.module("ts.controllers.toolbar",["ts.utils.constants"]).controller("ToolbarController",["$rootScope","$scope","EVENT_MODE_CHANGE","CMD_SHOW_ACTIVITY_PANEL",function(b,a,d,f){a.authorizationTypes=[{label:"\u6388\u6743\u6211\u53c2\u4e0e\u7684",value:"invited"},{label:"\u516c\u5f00\u7684",value:"public"},{label:"\u5168\u90e8",value:null}];a.statuses=[{label:"\u5f00\u653e\u7684",value:"active"},{label:"\u5173\u95ed\u7684",value:"closed"},{label:"\u5168\u90e8",value:null}];a.aTypeIndex=2;a.statusIndex=
2;a.searchKeyword="";a.showCreateActivityModal=function(a){a.currentTarget.classList.contains("disabled")||b.$emit(f)};a.updateQueryAndSearch=function(d,f){d&&(a[d]=f);var k={},g=a.authorizationTypes[a.aTypeIndex].value,n=a.statuses[a.statusIndex].value;g&&(k.authorize=g);n&&(k.status=n);a.searchKeyword&&(k.kw=a.searchKeyword);b.fetchActivities(k)};b.$on(d,function(b,d){a.updateQueryAndSearch()})}]);angular.module("ts.directives.ngEnter",[]).directive("ngEnter",function(){return{link:function(b,a,d){a.on("keydown",function(a){if(13==a.keyCode){var h=d.ngEnter;h&&_.bind(function(){eval("this."+h)},b)()}})}}});angular.module("ts.directives.activityDate",[]).directive("activityDate",function(){return{link:function(b,a,d){b=new Date(b.item.activities[0].info.date);a.text(b.getFullYear()+"\u5e74"+(b.getMonth()+1)+"\u6708"+b.getDate()+"\u65e5")}}});angular.module("ts.directives.activityDatePicker",[]).directive("activityDatePicker",function(){return{link:function(b,a,d){var f=new Date;f.setHours(0);f.setMinutes(0);f.setSeconds(0);f.setMilliseconds(0);var h=$(a).datepicker({onRender:function(a){return a.getTime()<f.getTime()?"disabled":""}}).on("changeDate",function(a){h.hide();var f=d.ngDateModel;f&&_.bind(function(a){eval("this."+f+"= event.date")},b)(a)}).data("datepicker")}}});(function(){angular.module("teacherSpace","ts.services.user ts.services.activity ts.controllers.main ts.controllers.navigator ts.controllers.toolbar ts.controllers.activityList ts.controllers.activityDetail ts.controllers.activityPanel ts.controllers.loginForm ts.directives.ngEnter ts.directives.activityDate ts.directives.activityDatePicker".split(" "))})();
