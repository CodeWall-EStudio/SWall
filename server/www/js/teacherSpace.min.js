!function(b){var a=function(d,a){this.element=b(d);this.format=e.parseFormat(a.format||this.element.data("date-format")||"mm/dd/yyyy");this.picker=b(e.template).appendTo("body").on({click:b.proxy(this.click,this)});this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):!1;if(this.isInput)this.element.on({focus:b.proxy(this.show,this),keyup:b.proxy(this.update,this)});else if(this.component)this.component.on("click",b.proxy(this.show,this));else this.element.on("click",
b.proxy(this.show,this));this.minViewMode=a.minViewMode||this.element.data("date-minviewmode")||0;if("string"===typeof this.minViewMode)switch(this.minViewMode){case "months":this.minViewMode=1;break;case "years":this.minViewMode=2;break;default:this.minViewMode=0}this.viewMode=a.viewMode||this.element.data("date-viewmode")||0;if("string"===typeof this.viewMode)switch(this.viewMode){case "months":this.viewMode=1;break;case "years":this.viewMode=2;break;default:this.viewMode=0}this.startViewMode=this.viewMode;
this.weekStart=a.weekStart||this.element.data("date-weekstart")||0;this.weekEnd=0===this.weekStart?6:this.weekStart-1;this.onRender=a.onRender;this.fillDow();this.fillMonths();this.update();this.showMode()};a.prototype={constructor:a,show:function(d){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();b(window).on("resize",b.proxy(this.place,this));d&&(d.stopPropagation(),d.preventDefault());var a=this;b(document).on("mousedown",function(d){0==
b(d.target).closest(".datepicker").length&&a.hide()});this.element.trigger({type:"show",date:this.date})},hide:function(){this.picker.hide();b(window).off("resize",this.place);this.viewMode=this.startViewMode;this.showMode();this.isInput||b(document).off("mousedown",this.hide);this.element.trigger({type:"hide",date:this.date})},set:function(){var d=e.formatDate(this.date,this.format);this.isInput?this.element.prop("value",d):(this.component&&this.element.find("input").prop("value",d),this.element.data("date",
d))},setValue:function(d){this.date="string"===typeof d?e.parseDate(d,this.format):new Date(d);this.set();this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill()},place:function(){var d=this.component?this.component.offset():this.element.offset();this.picker.css({top:d.top+this.height,left:d.left})},update:function(d){this.date=e.parseDate("string"===typeof d?d:this.isInput?this.element.prop("value"):this.element.data("date"),this.format);this.viewDate=new Date(this.date.getFullYear(),
this.date.getMonth(),1,0,0,0,0);this.fill()},fillDow:function(){for(var d=this.weekStart,a="<tr>";d<this.weekStart+7;)a+='<th class="dow">'+e.dates.daysMin[d++%7]+"</th>";a+="</tr>";this.picker.find(".datepicker-days thead").append(a)},fillMonths:function(){for(var d="",a=0;12>a;)d+='<span class="month">'+e.dates.monthsShort[a++]+"</span>";this.picker.find(".datepicker-months td").append(d)},fill:function(){var a=new Date(this.viewDate),b=a.getFullYear(),l=a.getMonth(),k=this.date.valueOf();this.picker.find(".datepicker-days th:eq(1)").text(e.dates.months[l]+
" "+b);var h=new Date(b,l-1,28,0,0,0,0),a=e.getDaysInMonth(h.getFullYear(),h.getMonth());h.setDate(a);h.setDate(a-(h.getDay()-this.weekStart+7)%7);var n=new Date(h);n.setDate(n.getDate()+42);for(var n=n.valueOf(),a=[],f,c,m;h.valueOf()<n;){h.getDay()===this.weekStart&&a.push("<tr>");f=this.onRender(h);c=h.getFullYear();m=h.getMonth();if(m<l&&c===b||c<b)f+=" old";else if(m>l&&c===b||c>b)f+=" new";h.valueOf()===k&&(f+=" active");a.push('<td class="day '+f+'">'+h.getDate()+"</td>");h.getDay()===this.weekEnd&&
a.push("</tr>");h.setDate(h.getDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(a.join(""));l=this.date.getFullYear();a=this.picker.find(".datepicker-months").find("th:eq(1)").text(b).end().find("span").removeClass("active");l===b&&a.eq(this.date.getMonth()).addClass("active");a="";b=10*parseInt(b/10,10);k=this.picker.find(".datepicker-years").find("th:eq(1)").text(b+"-"+(b+9)).end().find("td");b-=1;for(h=-1;11>h;h++)a+='<span class="year'+(-1===h||10===h?" old":"")+(l===b?" active":
"")+'">'+b+"</span>",b+=1;k.html(a)},click:function(a){a.stopPropagation();a.preventDefault();var g=b(a.target).closest("span, td, th");if(1===g.length)switch(g[0].nodeName.toLowerCase()){case "th":switch(g[0].className){case "switch":this.showMode(1);break;case "prev":case "next":this.viewDate["set"+e.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate["get"+e.modes[this.viewMode].navFnc].call(this.viewDate)+e.modes[this.viewMode].navStep*("prev"===g[0].className?-1:1)),this.fill(),this.set()}break;
case "span":g.is(".month")?(a=g.parent().find("span").index(g),this.viewDate.setMonth(a)):(g=parseInt(g.text(),10)||0,this.viewDate.setFullYear(g));0!==this.viewMode&&(this.date=new Date(this.viewDate),this.element.trigger({type:"changeDate",date:this.date,viewMode:e.modes[this.viewMode].clsName}));this.showMode(-1);this.fill();this.set();break;case "td":if(g.is(".day")&&!g.is(".disabled")){var l=parseInt(g.text(),10)||1;a=this.viewDate.getMonth();g.is(".old")?a-=1:g.is(".new")&&(a+=1);g=this.viewDate.getFullYear();
this.date=new Date(g,a,l,0,0,0,0);this.viewDate=new Date(g,a,Math.min(28,l),0,0,0,0);this.fill();this.set();this.element.trigger({type:"changeDate",date:this.date,viewMode:e.modes[this.viewMode].clsName})}}},mousedown:function(a){a.stopPropagation();a.preventDefault()},showMode:function(a){a&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+a)));this.picker.find(">div").hide().filter(".datepicker-"+e.modes[this.viewMode].clsName).show()}};b.fn.datepicker=function(d,g){return this.each(function(){var e=
b(this),k=e.data("datepicker"),h="object"===typeof d&&d;k||e.data("datepicker",k=new a(this,b.extend({},b.fn.datepicker.defaults,h)));if("string"===typeof d)k[d](g)})};b.fn.datepicker.defaults={onRender:function(a){return""}};b.fn.datepicker.Constructor=a;var e={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],dates:{days:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),daysShort:"Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),
daysMin:"Su Mo Tu We Th Fr Sa Su".split(" "),months:"January February March April May June July August September October November December".split(" "),monthsShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")},isLeapYear:function(a){return 0===a%4&&0!==a%100||0===a%400},getDaysInMonth:function(a,b){return[31,e.isLeapYear(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]},parseFormat:function(a){var b=a.match(/[.\/\-\s].*?/);a=a.split(/\W+/);if(!b||!a||0===a.length)throw Error("Invalid date format.");
return{separator:b,parts:a}},parseDate:function(a,b){var e=a.split(b.separator);a=new Date;var k;a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);if(e.length===b.parts.length){for(var h=a.getFullYear(),n=a.getDate(),f=a.getMonth(),c=0,m=b.parts.length;c<m;c++)switch(k=parseInt(e[c],10)||1,b.parts[c]){case "dd":case "d":n=k;a.setDate(k);break;case "mm":case "m":f=k-1;a.setMonth(k-1);break;case "yy":h=2E3+k;a.setFullYear(2E3+k);break;case "yyyy":h=k,a.setFullYear(k)}a=new Date(h,f,
n,0,0,0)}return a},formatDate:function(a,b){var e={d:a.getDate(),m:a.getMonth()+1,yy:a.getFullYear().toString().substring(2),yyyy:a.getFullYear()};e.dd=(10>e.d?"0":"")+e.d;e.mm=(10>e.m?"0":"")+e.m;a=[];for(var k=0,h=b.parts.length;k<h;k++)a.push(e[b.parts[k]]);return a.join(b.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};e.template='<div class="datepicker dropdown-menu"><div class="datepicker-days"><table class=" table-condensed">'+
e.headTemplate+'<tbody></tbody></table></div><div class="datepicker-months"><table class="table-condensed">'+e.headTemplate+e.contTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+e.headTemplate+e.contTemplate+"</table></div></div>"}(window.jQuery);(function(b){function a(a,f){this.itemsArray=[];this.$element=b(a);this.$element.hide();this.multiple=(this.isSelect="SELECT"===a.tagName)&&a.hasAttribute("multiple");this.objectItems=f&&f.itemValue;this.placeholderText=a.hasAttribute("placeholder")?this.$element.attr("placeholder"):"";this.inputSize=Math.max(1,this.placeholderText.length);this.$container=b('<div class="bootstrap-tagsinput"></div>');this.$input=b('<input size="'+this.inputSize+'" type="text" placeholder="'+this.placeholderText+'"/>').appendTo(this.$container);
this.$element.after(this.$container);this.build(f)}function e(a,b){if("function"!==typeof a[b]){var c=a[b];a[b]=function(a){return a[c]}}}function d(a,b){if("function"!==typeof a[b]){var c=a[b];a[b]=function(){return c}}}function g(a){return a?h.text(a).html():""}function l(a){var b=0;if(document.selection)a.focus(),b=document.selection.createRange(),b.moveStart("character",-a.value.length),b=b.text.length;else if(a.selectionStart||"0"==a.selectionStart)b=a.selectionStart;return b}var k={tagClass:function(a){return"label label-info"},
itemValue:function(a){return a?a.toString():a},itemText:function(a){return this.itemValue(a)},freeInput:!0,maxTags:void 0,confirmKeys:[13],onTagExists:function(a,b){b.hide().fadeIn()}};a.prototype={constructor:a,add:function(a,f){var c=this;if(!(c.options.maxTags&&c.itemsArray.length>=c.options.maxTags||!1!==a&&!a)){if("object"===typeof a&&!c.objectItems)throw"Can't add objects when itemValue option is not set";if(!a.toString().match(/^\s*$/)){c.isSelect&&!c.multiple&&0<c.itemsArray.length&&c.remove(c.itemsArray[0]);
if("string"===typeof a&&"INPUT"===this.$element[0].tagName){var m=a.split(",");if(1<m.length){for(var d=0;d<m.length;d++)this.add(m[d],!0);f||c.pushVal();return}}var e=c.options.itemValue(a),m=c.options.itemText(a),d=c.options.tagClass(a),h=b.grep(c.itemsArray,function(a){return c.options.itemValue(a)===e})[0];h?c.options.onTagExists&&(m=b(".tag",c.$container).filter(function(){return b(this).data("item")===h}),c.options.onTagExists(a,m)):(c.itemsArray.push(a),d=b('<span class="tag '+g(d)+'">'+g(m)+
'<span data-role="remove"></span></span>'),d.data("item",a),c.findInputWrapper().before(d),d.after(" "),c.isSelect&&!b('option[value="'+escape(e)+'"]',c.$element)[0]&&(m=b("<option selected>"+g(m)+"</option>"),m.data("item",a),m.attr("value",e),c.$element.append(m)),f||c.pushVal(),c.options.maxTags===c.itemsArray.length&&c.$container.addClass("bootstrap-tagsinput-max"),c.$element.trigger(b.Event("itemAdded",{item:a})))}}},remove:function(a,f){var c=this;c.objectItems&&(a="object"===typeof a?b.grep(c.itemsArray,
function(b){return c.options.itemValue(b)==c.options.itemValue(a)})[0]:b.grep(c.itemsArray,function(b){return c.options.itemValue(b)==a})[0]);a&&(b(".tag",c.$container).filter(function(){return b(this).data("item")===a}).remove(),b("option",c.$element).filter(function(){return b(this).data("item")===a}).remove(),c.itemsArray.splice(b.inArray(a,c.itemsArray),1));f||c.pushVal();c.options.maxTags>c.itemsArray.length&&c.$container.removeClass("bootstrap-tagsinput-max");c.$element.trigger(b.Event("itemRemoved",
{item:a}))},removeAll:function(){b(".tag",this.$container).remove();for(b("option",this.$element).remove();0<this.itemsArray.length;)this.itemsArray.pop();this.pushVal();this.options.maxTags&&!this.isEnabled()&&this.enable()},refresh:function(){var a=this;b(".tag",a.$container).each(function(){var f=b(this),c=f.data("item"),d=a.options.itemValue(c),e=a.options.itemText(c),h=a.options.tagClass(c);f.attr("class",null);f.addClass("tag "+g(h));f.contents().filter(function(){return 3==this.nodeType})[0].nodeValue=
g(e);a.isSelect&&b("option",a.$element).filter(function(){return b(this).data("item")===c}).attr("value",d)})},items:function(){return this.itemsArray},pushVal:function(){var a=this,f=b.map(a.items(),function(b){return a.options.itemValue(b).toString()});a.$element.val(f,!0).trigger("change")},build:function(a){var f=this;f.options=b.extend({},k,a);var c=f.options.typeahead||{};f.objectItems&&(f.options.freeInput=!1);e(f.options,"itemValue");e(f.options,"itemText");e(f.options,"tagClass");f.options.source&&
(c.source=f.options.source);c.source&&b.fn.typeahead&&(d(c,"source"),f.$input.typeahead({source:function(a,d){function e(a){for(var b=[],c=0;c<a.length;c++){var m=f.options.itemText(a[c]);g[m]=a[c];b.push(m)}d(b)}var g=this.map={},h=c.source(a);b.isFunction(h.success)?h.success(e):b.when(h).then(e)},updater:function(a){f.add(this.map[a])},matcher:function(a){return-1!==a.toLowerCase().indexOf(this.query.trim().toLowerCase())},sorter:function(a){return a.sort()},highlighter:function(a){return a.replace(RegExp("("+
this.query+")","gi"),"<strong>$1</strong>")}}));f.$container.on("click",b.proxy(function(a){f.$input.focus()},f));f.$container.on("keydown","input",b.proxy(function(a){var c=b(a.target),d=f.findInputWrapper();switch(a.which){case 8:0===l(c[0])&&(d=d.prev())&&f.remove(d.data("item"));break;case 46:0===l(c[0])&&(d=d.next())&&f.remove(d.data("item"));break;case 37:a=d.prev();0===c.val().length&&a[0]&&(a.before(d),c.focus());break;case 39:a=d.next();0===c.val().length&&a[0]&&(a.after(d),c.focus());break;
default:f.options.freeInput&&0<=b.inArray(a.which,f.options.confirmKeys)&&(f.add(c.val()),c.val(""),a.preventDefault())}c.attr("size",Math.max(this.inputSize,c.val().length))},f));f.$container.on("click","[data-role=remove]",b.proxy(function(a){f.remove(b(a.target).closest(".tag").data("item"))},f));f.options.itemValue===k.itemValue&&("INPUT"===f.$element[0].tagName?f.add(f.$element.val()):b("option",f.$element).each(function(){f.add(b(this).attr("value"),!0)}))},destroy:function(){this.$container.off("keypress",
"input");this.$container.off("click","[role=remove]");this.$container.remove();this.$element.removeData("tagsinput");this.$element.show()},focus:function(){this.$input.focus()},input:function(){return this.$input},findInputWrapper:function(){for(var a=this.$input[0],f=this.$container[0];a&&a.parentNode!==f;)a=a.parentNode;return b(a)}};b.fn.tagsinput=function(d,f){var c=[];this.each(function(){var e=b(this).data("tagsinput");e?(e=e[d](f),void 0!==e&&c.push(e)):(e=new a(this,d),b(this).data("tagsinput",
e),c.push(e),"SELECT"===this.tagName&&b("option",b(this)).attr("selected","selected"),b(this).val(b(this).val()))});return"string"==typeof d?1<c.length?c:c[0]:c};b.fn.tagsinput.Constructor=a;var h=b("<div />");b(function(){b("input[data-role=tagsinput], select[multiple][data-role=tagsinput]").tagsinput()})})(window.jQuery);angular.module("ts.services.user",[]).constant("EVENT_LOGIN","event.login").service("UserService",["$rootScope","$location","EVENT_LOGIN",function(b,a,e){function d(){return a.search().uid}return{uid:d,hasLoggedIn:function(){return void 0!==d()},login:function(d,l,k){a.search("uid",d);k(0);b.$emit(e,0)}}}]);angular.module("ts.services.activity",["ts.services.user"]).constant("BACKEND_SERVER","localhost"==location.hostname?"http://localhost:8080":"").service("ActivityService",["$rootScope","$http","UserService","BACKEND_SERVER",function(b,a,e,d){function g(a){a&&(b.selectedActivity=a,b.selectedActivityID=a._id,console.log("[ActivityService] selected activity",b.selectedActivity))}function l(f,c,h,g){c=n(c);a.put(d+"/activities/"+f+"?uid="+e.uid(),c,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,
c){if(a&&!a.c&&a.r)a:{var d=a.r;b.activityMap[d._id]=d;for(var f=0;f<b.activityList.length;++f)for(var e=b.activityList[f].activities,g=0;g<e.length;++g)if(e[g]._id==d._id){b.selectedActivity==e[g]&&(b.selectedActivity=d,b.selectedActivityID=d._id);e[g]=d;break a}}h&&h(a,c)}).error(g)}function k(a,c){b.activityList.splice(a,0,{date:h(c),activities:[c]})}function h(a){a=new Date(a.info.date);a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);return a.getTime().toString()}function n(a){return _.map(a,
function(a,b){return encodeURIComponent(b)+"="+encodeURIComponent(a)}).join("&")}b.activityList=[];b.activityMap={};b.selectedActivity=null;b.selectedActivityID="";return{selectActivity:g,selectActivityByID:function(a){g(b.activityMap[a])},fetchActivities:function(f,c,g){f=f||{};"manager"==b.mode()&&(f.creator=e.uid());console.log("[ActivityService] fetching activities with",f);a.get(d+"/activities?uid="+e.uid(),{responseType:"json",params:f}).success(function(a,d){if(200===d&&!a.c){var e=a.r.activities,
f=_.groupBy(e,function(a){return h(a)});b.activityList=_.map(f,function(a,b){return{date:b,activities:a}});b.activityMap=_.reduce(e,function(a,b){a[b._id]=b;return a},{})}c&&c(a,d)}).error(g)},createActivity:function(f,c,g){f=n(f);a.post(d+"/activities?uid="+e.uid(),f,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,d){if(a&&!a.c&&a.r)a:{var e=a.r[0];b.activityMap[e._id]=e;for(var f=h(e),g=0;g<b.activityList.length;++g){var l=b.activityList[g];
if(l.date==f){l.activities.unshift(e);break a}else if(l.date>f){k(g,e);break a}}k(g,e)}c&&c(a,d)}).error(g)},updateActivity:l,closeActivity:function(a,b,d){l(a,{status:"closed"},b,d)},fetchActivityConfig:function(b,c){a.get(d+"/activities/config",null,{responseType:"json"}).success(function(a,c){console.log("[ActivityService] activity config =",a);b&&b(a,c)}).error(function(a,b){console.error("[ActivityService] FAIL TO FETCH ACTIVITY CONFIGURATIONS");c&&c(a,b)})}}}]);angular.module("ts.controllers.activityDetail",["ts.services.activity","ts.controllers.activityPanel"]).controller("ActivityDetailController",["$rootScope","$scope","ActivityService","CMD_SHOW_ACTIVITY_PANEL",function(b,a,e,d){a.userCount=function(){if(b.selectedActivity){if(b.selectedActivity.active)return b.selectedActivity.users.participators.length;var a=_.countBy(b.selectedActivity.resources,function(a){return a.user});return _.keys(a).length}return 0};a.editActivity=function(a){b.$emit(d,{panelTitle:"\u7f16\u8f91\u6d3b\u52a8",
confirmBtnTitle:"\u4fdd\u5b58",activity:$.extend(!0,{},a)})};a.closeActivity=function(a){confirm("\u786e\u5b9a\u8981\u5173\u95ed\u6d3b\u52a8\uff1f")&&e.closeActivity(a._id)};a.deleteActivity=function(a){}}]);angular.module("ts.controllers.activityList",["ts.services.activity"]).controller("ActivityListController",["$rootScope","$scope","ActivityService",function(b,a,e){a.selectActivity=function(a){e.selectActivityByID(a)}}]);angular.module("ts.controllers.activityPanel",["ts.services.activity"]).constant("CMD_SHOW_ACTIVITY_PANEL","cmd.activity.panel.show").controller("ActivityPanelController",["$rootScope","$scope","$http","ActivityService","CMD_SHOW_ACTIVITY_PANEL",function(b,a,e,d,g){function l(a,b){console.log(a,b);c.removeAttribute("disabled");n.modal("hide")}function k(b,d){b=b||{c:-1,msg:"UNKNOWN"};a.errMsg=d+" - ["+b.c+"] "+b.m;c.removeAttribute("disabled")}function h(){c.setAttribute("disabled","disabled")}var n=
$("#createActivityModal");$("input[activity-date-picker]");var f=$('input[data-role="tagsinput"]'),c=document.getElementById("activityFormAllFields"),m=document.getElementById("activityFormFieldsForOpenActivities"),p={info:{type:1},users:{invitedUsers:[]}};b.$on(g,function(b,c){c=c||{};a.panelTitle=c.panelTitle||"\u521b\u5efa\u6d3b\u52a8";a.confirmBtnTitle=c.confirmBtnTitle||"\u521b\u5efa\u6d3b\u52a8";a.cancelBtnTitle=c.cancelBtnTitle||"\u53d6\u6d88";a.activity=c.activity||$.extend(!0,{},p);a.invitedUsers=
a.activity.users.invitedUsers.join(",");_.each(a.activity.users.invitedUsers,function(a){f.tagsinput("add",a)});a.showActivityPanel()});n.on("hidden.bs.modal",function(){a.activity=$.extend(!0,{},p);a.grade=a.cls=a.subject=0;a.errMsg="";f.tagsinput("removeAll")});a.$watch("grade",function(b){a.cls=0});a.showActivityPanel=function(){$("#createActivityModal").modal("show");!a.activity._id||a.activity.active?m.removeAttribute("disabled"):m.setAttribute("disabled","disabled")};a.createActivity=function(){a.errMsg=
"";h();var b=a.config?a.config.activityConfig:{},b={uids:a.invitedUsers||"",title:a.activity.info.title||"",type:a.activity.info.type|1,desc:a.activity.info.desc||"",date:a.activity.info.date?a.activity.info.date.getTime():0,teacher:a.activity.info.teacher||"",grade:b.classes[a.grade].grade,"class":b.classes[a.grade].cls[a.cls],subject:b.subjects[a.subject],domain:a.activity.info.domain||""};d.createActivity(b,l,k)};a.updateActivity=function(){a.errMsg="";h();var b=a.config?a.config.activityConfig:
{},c={uids:a.invitedUsers||""};a.activity.active&&(c.title=a.activity.info.title||"",c.type=a.activity.info.type||"",c.desc=a.activity.info.desc||"",c.date=a.activity.info.date||0,c.teacher=a.activity.info.teacher||"",c.grade=b.classes[a.grade].grade||"",c["class"]=b.classes[a.grade].cls[a.cls]||"",c.subject=b.subjects[a.subject]||"",c.domain=a.activity.info.domain||"");d.updateActivity(a.activity._id,c,l,k)};a.handleConfirmBtnClick=function(){a.activity._id?a.updateActivity():a.createActivity()};
(function(){d.fetchActivityConfig(function(b,c){a.config=b;a.grade=0;a.cls=0;a.subject=0})})()}]);angular.module("ts.controllers.loginForm",["ts.services.user"]).controller("LoginFormController",["$rootScope","$scope","UserService",function(b,a,e){a.uid="";a.pwd="";a.errMsg="";a.login=function(){a.uid?a.pwd?e.login(a.uid,a.pwd,function(b){b||$("#loginModal").modal("hide");a.uid=a.pwd=a.errMsg=""}):a.errMsg="\u8bf7\u8f93\u5165\u5bc6\u7801":a.errMsg="\u8bf7\u8f93\u5165\u5e10\u53f7\u540d"}}]);angular.module("ts.controllers.main",["ts.services.user","ts.services.activity"]).controller("MainController",["$rootScope","$scope","$http","$location","UserService","ActivityService","EVENT_LOGIN",function(b,a,e,d,g,l,k){b.$on(k,function(a,d){b.fetchActivities()});b.fetchActivities=function(a){l.selectActivity();l.fetchActivities(a)};b.showLoginModal=function(){g.hasLoggedIn()||$("#loginModal").modal("show")};b.mode=function(){return d.search().mode};b.gotoMode=function(a){d.search("mode",a);b.$emit("event.mode.change",
a)};g.hasLoggedIn()?b.fetchActivities():b.showLoginModal()}]);angular.module("ts.controllers.navigator",["ts.services.user"]).controller("NavigatorController",["$rootScope","$scope","UserService","EVENT_LOGIN",function(b,a,e,d){a.username=e.uid();b.$on(d,function(b,d){a.username=e.uid()})}]);angular.module("ts.controllers.toolbar",["ts.services.user","ts.controllers.activityPanel"]).constant("EVENT_MODE_CHANGE","event.mode.change").controller("ToolbarController",["$rootScope","$scope","EVENT_MODE_CHANGE","CMD_SHOW_ACTIVITY_PANEL",function(b,a,e,d){a.authorizationTypes=[{label:"\u6388\u6743\u6211\u53c2\u4e0e\u7684",value:"invited"},{label:"\u516c\u5f00\u7684",value:"public"},{label:"\u5168\u90e8",value:null}];a.statuses=[{label:"\u5f00\u653e\u7684",value:"active"},{label:"\u5173\u95ed\u7684",
value:"closed"},{label:"\u5168\u90e8",value:null}];a.aTypeIndex=2;a.statusIndex=2;a.searchKeyword="";a.showCreateActivityModal=function(a){a.currentTarget.classList.contains("disabled")||b.$emit(d)};a.updateQueryAndSearch=function(d,e){d&&(a[d]=e);var k={},h=a.authorizationTypes[a.aTypeIndex].value,n=a.statuses[a.statusIndex].value;h&&(k.authorize=h);n&&(k.status=n);a.searchKeyword&&(k.kw=a.searchKeyword);b.fetchActivities(k)};b.$on(e,function(b,d){a.updateQueryAndSearch()})}]);angular.module("ts.directives.ngEnter",[]).directive("ngEnter",function(){return{link:function(b,a,e){a.on("keydown",function(a){if(13==a.keyCode){var g=e.ngEnter;g&&_.bind(function(){eval("this."+g)},b)()}})}}});angular.module("ts.directives.activityDate",[]).directive("activityDate",function(){return{link:function(b,a,e){b=new Date(b.item.activities[0].info.date);a.text(b.getFullYear()+"\u5e74"+(b.getMonth()+1)+"\u6708"+b.getDate()+"\u65e5")}}});angular.module("ts.directives.activityDatePicker",[]).directive("activityDatePicker",function(){return{link:function(b,a,e){var d=new Date;d.setHours(0);d.setMinutes(0);d.setSeconds(0);d.setMilliseconds(0);var g=$(a).datepicker({onRender:function(a){return a.getTime()<d.getTime()?"disabled":""}}).on("changeDate",function(a){g.hide();var d=e.ngDateModel;d&&_.bind(function(a){eval("this."+d+"= event.date")},b)(a)}).data("datepicker")}}});(function(){angular.module("teacherSpace","ts.services.user ts.services.activity ts.controllers.main ts.controllers.navigator ts.controllers.toolbar ts.controllers.activityList ts.controllers.activityDetail ts.controllers.activityPanel ts.controllers.loginForm ts.directives.ngEnter ts.directives.activityDate ts.directives.activityDatePicker".split(" "))})();
