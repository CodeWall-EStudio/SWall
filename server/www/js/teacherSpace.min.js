!function(c){var d=function(a,b){this.element=c(a);this.format=e.parseFormat(b.format||this.element.data("date-format")||"mm/dd/yyyy");this.picker=c(e.template).appendTo("body").on({click:c.proxy(this.click,this)});this.isInput=this.element.is("input");this.component=this.element.is(".date")?this.element.find(".add-on"):!1;if(this.isInput)this.element.on({focus:c.proxy(this.show,this),keyup:c.proxy(this.update,this)});else if(this.component)this.component.on("click",c.proxy(this.show,this));else this.element.on("click",
c.proxy(this.show,this));this.minViewMode=b.minViewMode||this.element.data("date-minviewmode")||0;if("string"===typeof this.minViewMode)switch(this.minViewMode){case "months":this.minViewMode=1;break;case "years":this.minViewMode=2;break;default:this.minViewMode=0}this.viewMode=b.viewMode||this.element.data("date-viewmode")||0;if("string"===typeof this.viewMode)switch(this.viewMode){case "months":this.viewMode=1;break;case "years":this.viewMode=2;break;default:this.viewMode=0}this.startViewMode=this.viewMode;
this.weekStart=b.weekStart||this.element.data("date-weekstart")||0;this.weekEnd=0===this.weekStart?6:this.weekStart-1;this.onRender=b.onRender;this.fillDow();this.fillMonths();this.update();this.showMode()};d.prototype={constructor:d,show:function(a){this.picker.show();this.height=this.component?this.component.outerHeight():this.element.outerHeight();this.place();c(window).on("resize",c.proxy(this.place,this));a&&(a.stopPropagation(),a.preventDefault());var b=this;c(document).on("mousedown",function(a){0==
c(a.target).closest(".datepicker").length&&b.hide()});this.element.trigger({type:"show",date:this.date})},hide:function(){this.picker.hide();c(window).off("resize",this.place);this.viewMode=this.startViewMode;this.showMode();this.isInput||c(document).off("mousedown",this.hide);this.element.trigger({type:"hide",date:this.date})},set:function(){var a=e.formatDate(this.date,this.format);this.isInput?this.element.prop("value",a):(this.component&&this.element.find("input").prop("value",a),this.element.data("date",
a))},setValue:function(a){this.date="string"===typeof a?e.parseDate(a,this.format):new Date(a);this.set();this.viewDate=new Date(this.date.getFullYear(),this.date.getMonth(),1,0,0,0,0);this.fill()},place:function(){var a=this.component?this.component.offset():this.element.offset();this.picker.css({top:a.top+this.height,left:a.left})},update:function(a){this.date=e.parseDate("string"===typeof a?a:this.isInput?this.element.prop("value"):this.element.data("date"),this.format);this.viewDate=new Date(this.date.getFullYear(),
this.date.getMonth(),1,0,0,0,0);this.fill()},fillDow:function(){for(var a=this.weekStart,b="<tr>";a<this.weekStart+7;)b+='<th class="dow">'+e.dates.daysMin[a++%7]+"</th>";b+="</tr>";this.picker.find(".datepicker-days thead").append(b)},fillMonths:function(){for(var a="",b=0;12>b;)a+='<span class="month">'+e.dates.monthsShort[b++]+"</span>";this.picker.find(".datepicker-months td").append(a)},fill:function(){var a=new Date(this.viewDate),b=a.getFullYear(),c=a.getMonth(),d=this.date.valueOf();this.picker.find(".datepicker-days th:eq(1)").text(e.dates.months[c]+
" "+b);var f=new Date(b,c-1,28,0,0,0,0),a=e.getDaysInMonth(f.getFullYear(),f.getMonth());f.setDate(a);f.setDate(a-(f.getDay()-this.weekStart+7)%7);var k=new Date(f);k.setDate(k.getDate()+42);for(var k=k.valueOf(),a=[],g,h,m;f.valueOf()<k;){f.getDay()===this.weekStart&&a.push("<tr>");g=this.onRender(f);h=f.getFullYear();m=f.getMonth();if(m<c&&h===b||h<b)g+=" old";else if(m>c&&h===b||h>b)g+=" new";f.valueOf()===d&&(g+=" active");a.push('<td class="day '+g+'">'+f.getDate()+"</td>");f.getDay()===this.weekEnd&&
a.push("</tr>");f.setDate(f.getDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(a.join(""));c=this.date.getFullYear();a=this.picker.find(".datepicker-months").find("th:eq(1)").text(b).end().find("span").removeClass("active");c===b&&a.eq(this.date.getMonth()).addClass("active");a="";b=10*parseInt(b/10,10);d=this.picker.find(".datepicker-years").find("th:eq(1)").text(b+"-"+(b+9)).end().find("td");b-=1;for(f=-1;11>f;f++)a+='<span class="year'+(-1===f||10===f?" old":"")+(c===b?" active":
"")+'">'+b+"</span>",b+=1;d.html(a)},click:function(a){a.stopPropagation();a.preventDefault();var b=c(a.target).closest("span, td, th");if(1===b.length)switch(b[0].nodeName.toLowerCase()){case "th":switch(b[0].className){case "switch":this.showMode(1);break;case "prev":case "next":this.viewDate["set"+e.modes[this.viewMode].navFnc].call(this.viewDate,this.viewDate["get"+e.modes[this.viewMode].navFnc].call(this.viewDate)+e.modes[this.viewMode].navStep*("prev"===b[0].className?-1:1)),this.fill(),this.set()}break;
case "span":b.is(".month")?(a=b.parent().find("span").index(b),this.viewDate.setMonth(a)):(b=parseInt(b.text(),10)||0,this.viewDate.setFullYear(b));0!==this.viewMode&&(this.date=new Date(this.viewDate),this.element.trigger({type:"changeDate",date:this.date,viewMode:e.modes[this.viewMode].clsName}));this.showMode(-1);this.fill();this.set();break;case "td":if(b.is(".day")&&!b.is(".disabled")){var d=parseInt(b.text(),10)||1;a=this.viewDate.getMonth();b.is(".old")?a-=1:b.is(".new")&&(a+=1);b=this.viewDate.getFullYear();
this.date=new Date(b,a,d,0,0,0,0);this.viewDate=new Date(b,a,Math.min(28,d),0,0,0,0);this.fill();this.set();this.element.trigger({type:"changeDate",date:this.date,viewMode:e.modes[this.viewMode].clsName})}}},mousedown:function(a){a.stopPropagation();a.preventDefault()},showMode:function(a){a&&(this.viewMode=Math.max(this.minViewMode,Math.min(2,this.viewMode+a)));this.picker.find(">div").hide().filter(".datepicker-"+e.modes[this.viewMode].clsName).show()}};c.fn.datepicker=function(a,b){return this.each(function(){var e=
c(this),l=e.data("datepicker"),f="object"===typeof a&&a;l||e.data("datepicker",l=new d(this,c.extend({},c.fn.datepicker.defaults,f)));if("string"===typeof a)l[a](b)})};c.fn.datepicker.defaults={onRender:function(a){return""}};c.fn.datepicker.Constructor=d;var e={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],dates:{days:"Sunday Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),daysShort:"Sun Mon Tue Wed Thu Fri Sat Sun".split(" "),
daysMin:"Su Mo Tu We Th Fr Sa Su".split(" "),months:"January February March April May June July August September October November December".split(" "),monthsShort:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")},isLeapYear:function(a){return 0===a%4&&0!==a%100||0===a%400},getDaysInMonth:function(a,b){return[31,e.isLeapYear(a)?29:28,31,30,31,30,31,31,30,31,30,31][b]},parseFormat:function(a){var b=a.match(/[.\/\-\s].*?/);a=a.split(/\W+/);if(!b||!a||0===a.length)throw Error("Invalid date format.");
return{separator:b,parts:a}},parseDate:function(a,b){var c=a.split(b.separator);a=new Date;var d;a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);if(c.length===b.parts.length){for(var e=a.getFullYear(),k=a.getDate(),g=a.getMonth(),h=0,m=b.parts.length;h<m;h++)switch(d=parseInt(c[h],10)||1,b.parts[h]){case "dd":case "d":k=d;a.setDate(d);break;case "mm":case "m":g=d-1;a.setMonth(d-1);break;case "yy":e=2E3+d;a.setFullYear(2E3+d);break;case "yyyy":e=d,a.setFullYear(d)}a=new Date(e,g,
k,0,0,0)}return a},formatDate:function(a,b){var c={d:a.getDate(),m:a.getMonth()+1,yy:a.getFullYear().toString().substring(2),yyyy:a.getFullYear()};c.dd=(10>c.d?"0":"")+c.d;c.mm=(10>c.m?"0":"")+c.m;a=[];for(var d=0,e=b.parts.length;d<e;d++)a.push(c[b.parts[d]]);return a.join(b.separator)},headTemplate:'<thead><tr><th class="prev">&lsaquo;</th><th colspan="5" class="switch"></th><th class="next">&rsaquo;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>'};e.template='<div class="datepicker dropdown-menu"><div class="datepicker-days"><table class=" table-condensed">'+
e.headTemplate+'<tbody></tbody></table></div><div class="datepicker-months"><table class="table-condensed">'+e.headTemplate+e.contTemplate+'</table></div><div class="datepicker-years"><table class="table-condensed">'+e.headTemplate+e.contTemplate+"</table></div></div>"}(window.jQuery);(function(){angular.module("TeacherSpace",[]).controller("MainController",["$rootScope","$scope","$http",function(c,d,e){c.uid="oscar";c.activityID="";c.activity=null;c.fetchActivities=function(a){c.activityID="";c.activity=null;e.get("/activities?uid="+c.uid,{responseType:"json",params:a}).success(function(a,d){if(200===d&&!a.c){var e=a.r.activities,f=_.groupBy(e,function(a){var b=new Date(a.info.date);a=b.getFullYear();var c=b.getMonth()+1,b=b.getDate();return[a,c,b].join("_")});c.activityList=
_.map(f,function(a,b){return{date:b,activities:a}});c.activityMap=_.reduce(e,function(a,b){a[b._id]=b;return a},{})}}).error(function(a,c){})};c.fetchActivities()}]).controller("NavigatorController",["$rootScope","$scope",function(c,d){}]).controller("ToolbarController",["$rootScope","$scope",function(c,d){d.authorizationTypes=[{label:"\u6388\u6743\u6211\u53c2\u4e0e\u7684",value:"invited"},{label:"\u516c\u5f00\u7684",value:"public"},{label:"\u5168\u90e8",value:null}];d.statuses=[{label:"\u5f00\u653e\u7684",
value:"active"},{label:"\u5173\u95ed\u7684",value:"closed"},{label:"\u5168\u90e8",value:null}];d.aTypeIndex=2;d.statusIndex=2;d.searchKeyword="";d.updateQueryCondition=function(e,a){if(d[e]!==a){d[e]=a;var b={},n=d.authorizationTypes[d.aTypeIndex].value,l=d.statuses[d.statusIndex].value;n&&(b.authorize=n);l&&(b.status=l);d.searchKeyword&&(b.kw=d.searchKeyword);c.fetchActivities(b)}}}]).controller("ActivityListController",["$rootScope","$scope",function(c,d){d.selectActivity=function(d){c.activityID=
d;c.activity=c.activityMap[d]}}]).controller("ActivityDetailController",["$rootScope","$scope",function(c,d){d.userCount=function(){if(c.activity){if(c.activity.active)return c.activity.users.participators.length;var d=_.countBy(c.activity.resources,function(a){return a.user});return _.keys(d).length}return 0}}]).controller("ActivityFieldsController",["$rootScope","$scope","$http",function(c,d,e){d.type=1;d.createActivity=function(){var a={uids:d.invitedUsers?d.invitedUsers:"",title:d.title||"",type:d.type|
0,desc:d.desc||"",date:d.date?d.date.getTime():0,teacher:d.teacher||"",grade:d.grade||"","class":d["class"]||"",subject:d.subject||"",domain:d.domain||""},a=_.map(a,function(a,c){return encodeURIComponent(c)+"="+encodeURIComponent(a)}).join("&");e.post("/activities?uid="+c.uid,a,{responseType:"json",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(a,c){console.log(a,c)}).error(function(a,c){console.error(a,c)})}}]).directive("activityDate",function(){return{link:function(c,
d,e){c=c.item.date.split("_");d.text(c[0]+"\u5e74"+c[1]+"\u6708"+c[2]+"\u65e5")}}}).directive("activityDatePicker",function(){return{link:function(c,d,e){var a=new Date,b=$(d).datepicker({onRender:function(b){return b.getTime()<a.getTime()?"disabled":""}}).on("changeDate",function(a){b.hide();var d=e.ngModel;d&&(c[d]=a.date)}).data("datepicker")}}})})();
